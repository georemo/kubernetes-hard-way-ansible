Experiencing issue:https://serverfault.com/questions/500764/dpkg-reconfigure-unable-to-re-open-stdin-no-file-or-directory
adopteed: export DEBIAN_FRONTEND=noninteractive

- after vagrant up, (if no dedicated dns server)check that all machines have the /etc/hosts set properly
- otherwise if dedicated server is set, make sure /etc/resolve.conf has the right nameserver
- confirm the machines can ping each other

#############################################
# # file: roles/kubernetes-worker/tasks/install-worker.yml
# wget https://github.com/opencontainers/runc/releases/download/v1.1.3/runc.amd64
# wget https://storage.googleapis.com/gvisor/releases/release/20220510/x86_64/runsc
# wget https://storage.googleapis.com/gvisor/releases/release/20220510/x86_64/containerd-shim-runsc-v1
# wget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz

# mv runc.amd64 runc
# chmod +x runc runsc containerd-shim-runsc-v1
# sudo mv runc runsc containerd-shim-runsc-v1 /usr/local/bin/
# sudo tar -xvf cni-plugins-linux-amd64-v1.1.1.tgz -C /opt/cni/bin/


#############################################
# resolving download latency issues
# long term measure can involve ansible process that downloads all required files the scripts process for sharing the downloads
# this would ensure the download is only done once
# # file: roles/kubernetes-worker/tasks/install-worker.yml
# wget https://github.com/opencontainers/runc/releases/download/v1.1.3/runc.amd64
# wget https://storage.googleapis.com/gvisor/releases/release/20220510/x86_64/runsc
# wget https://storage.googleapis.com/gvisor/releases/release/20220510/x86_64/containerd-shim-runsc-v1
# wget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz

###################################################################
# sorting overlay issue in lxd containers
# file: roles/kubernetes-worker/tasks/install-worker.yml
# error message: No such file or directory: '/lib/modules/5.15.0-57-generic/modules.builtin'
# Solution: https://discuss.linuxcontainers.org/t/how-to-add-kernel-modules-into-an-lxc-container/5033
sudo lxc config set kubernetes-cluster-01-worker-0 linux.kernel_modules ip_tables,ip6_tables,netlink_diag,nf_nat,overlay,br_netfilter
lxc config set kubernetes-cluster-01-worker-0 security.nesting true
# the above can be incoporated in the ansible process.  This can be done just after creation of the containers...from the host
# check new status:
lxc config show kubernetes-cluster-01-worker-0

# the above did not work:
# issue: containerd cannot start in lxd
# solution: https://forum.proxmox.com/threads/k3s-on-lxc-modprob-fatal-module-overlay-not-found-in-directory-lib-modules-5-13-19-1-pve.100584/
root@kubernetes-cluster-01-worker-0 ~# journalctl -xeu containerd.service
░░ The job identifier is 21738 and the job result is done.
Jan 18 08:40:53 kubernetes-cluster-01-worker-0 systemd[1]: Starting containerd container runtime...
░░ Subject: A start job for unit containerd.service has begun execution
░░ Defined-By: systemd
░░ Support: http://www.ubuntu.com/support
░░ 
░░ A start job for unit containerd.service has begun execution.
░░ 
░░ The job identifier is 21738.
Jan 18 08:40:53 kubernetes-cluster-01-worker-0 modprobe[3421]: modprobe: FATAL: Module overlay not found in directory /lib/modules/5.15.0-57-generic

Procedure:
nano /etc/modules-load.d/modules.conf
then add:
ip_tables
ip6_tables
netlink_diag
nf_nat
overlay
br_netfilter
then:
file: roles/kubernetes-worker/templates/containerd.service.j2
comment the line:
# ExecStartPre=/sbin/modprobe overlay
then:
systemctl daemon-reload
systemctl start containerd.service




